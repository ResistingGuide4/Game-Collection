class PieceSelector{constructor($,e,t){this.x=$,this.y=e,this.boardWidth=t,this.pieces=this.generatePieces(),this.filledInds=[1,1,1]}generatePieces(){var $=[,,,];for(let e=0;e<$.length;e++){let t=Math.floor(22*Math.random()),s=Math.floor(5*Math.random())+1;switch(t){case 0:$[e]=[[s,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],1,1];break;case 1:$[e]=[[s,0,0,0,0],[0,s,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],2,2];break;case 2:$[e]=[[0,s,0,0,0],[s,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],2,2];break;case 3:$[e]=[[s,s,0,0,0],[s,0,0,0,0],[s,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],2,3];break;case 4:$[e]=[[s,s,s,0,0],[0,0,s,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],3,2];break;case 5:$[e]=[[0,s,0,0,0],[0,s,0,0,0],[s,s,0,0,0],[0,0,0,0,0],[0,0,0,0,0],2,3];break;case 6:$[e]=[[s,0,0,0,0],[s,s,s,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],3,2];break;case 7:$[e]=[[s,s,0,0,0],[0,s,0,0,0],[0,s,0,0,0],[0,0,0,0,0],[0,0,0,0,0],2,3];break;case 8:$[e]=[[0,0,s,0,0],[s,s,s,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],3,2];break;case 9:$[e]=[[s,0,0,0,0],[s,0,0,0,0],[s,s,0,0,0],[0,0,0,0,0],[0,0,0,0,0],2,3];break;case 10:$[e]=[[s,s,s,0,0],[s,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],3,2];break;case 11:$[e]=[[s,s,s,0,0],[s,s,s,0,0],[s,s,s,0,0],[0,0,0,0,0],[0,0,0,0,0],3,3];break;case 12:$[e]=[[s,s,0,0,0],[s,s,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],2,2];break;case 13:$[e]=[[s,0,0,0,0],[s,s,0,0,0],[0,s,0,0,0],[0,0,0,0,0],[0,0,0,0,0],2,3];break;case 14:$[e]=[[0,s,s,0,0],[s,s,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],3,2];break;case 15:$[e]=[[0,s,0,0,0],[s,s,0,0,0],[s,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],2,3];break;case 16:$[e]=[[s,s,0,0,0],[0,s,s,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],3,2];break;case 17:$[e]=[[s,s,s,s,s],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],5,1];break;case 18:$[e]=[[s,0,0,0,0],[s,0,0,0,0],[s,0,0,0,0],[s,0,0,0,0],[s,0,0,0,0],1,5];break;case 19:$[e]=[[s,s,s,0,0],[0,s,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],3,2];break;case 20:$[e]=[[0,s,0,0,0],[s,s,0,0,0],[0,s,0,0,0],[0,0,0,0,0],[0,0,0,0,0],2,3];break;case 21:$[e]=[[0,s,0,0,0],[s,s,s,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],3,2];break;case 22:$[e]=[[s,0,0,0,0],[s,s,0,0,0],[s,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],2,3];break;case 23:$[e]=[[s,0,0,0,0],[s,0,0,0,0],[s,0,0,0,0],[s,0,0,0,0],[0,0,0,0,0],1,4];break;case 23:$[e]=[[s,s,s,s,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],1,4]}}return $}setPiece($,e){pieces[$]=e}draw($,e,t="select",s=[0,0],l=!0,i=this.x,c=this.y,a=this.boardWidth){$.fillStyle="green",$.fillRect(i,c,a,5*a/12);let r=a/25,h=a/4,o=(17*a/12-a-5*r)/2;$.fillStyle="lightBlue",this.pieces.forEach((s,l)=>{if(s){$.globalAlpha=.5,"select"==t?l==e&&($.globalAlpha=1):l==e&&($.globalAlpha=0);for(let a=0;a<5;a++)for(let d=0;d<5;d++)if(s[a][d]){switch(s[a][d]){case 1:$.fillStyle="lightBlue";break;case 2:$.fillStyle="purple";break;case 3:$.fillStyle="red";break;case 4:$.fillStyle="yellow";break;case 5:$.fillStyle="orange"}$.strokeWidth=0,$.fillRect(h*(l+1)+i+d*r,c+a*r+o,r,r)}}}),$.globalAlpha=.7;let d=a/8,n=this.pieces[e];if(l?$.fillStyle="red":$.fillStyle="rgb(50, 255, 50)","place"==t)for(let f=0;f<5;f++)for(let b=0;b<5;b++)n[f][b]&&$.fillRect(i+s[0]*d+d*b,c-a+s[1]*d+d*f,d,d);$.globalAlpha=1}}class Controls{constructor(){this.up=!1,this.down=!1,this.right=!1,this.left=!1,this.esc=!1,this.enter=!1,this.#a()}#a(){document.addEventListener("keydown",$=>{switch($.key){case"ArrowUp":this.up=!0;break;case"ArrowRight":this.right=!0;break;case"ArrowDown":this.down=!0;break;case"ArrowLeft":this.left=!0;break;case"Enter":this.enter=!0;break;case"Escape":this.esc=!0}})}}class Board{constructor($,e,t,s="KEYS"){this.x=$,this.y=e,this.width=t,this.height=17*t/12,this.squareWidth=t/8,this.selectedIndex=0,this.mode="select",this.placeLoc=[0,0],this.score=0,this.boardValues=Array.from({length:8},()=>Array(8).fill(0)),this.pieceSelector=new PieceSelector($,e+t,t),this.controls=new Controls}update(){var $=this.pieceSelector.pieces[this.selectedIndex],e=$[5],t=$[6];this.#b($,e,t)}#b($,e,t){if(this.controls.up&&("place"==this.mode&&(this.placeLoc[1]=(this.placeLoc[1]+8-t)%(9-t)),this.controls.up=!1),this.controls.down&&("place"==this.mode&&(this.placeLoc[1]=(this.placeLoc[1]+1)%(9-t)),this.controls.down=!1),this.controls.left){if("place"==this.mode)this.placeLoc[0]=(this.placeLoc[0]+8-e)%(9-e);else{this.selectedIndex=(this.selectedIndex+2)%3;for(var s=0;!this.pieceSelector.filledInds[this.selectedIndex];)this.selectedIndex=(this.selectedIndex+2)%3,s++}this.controls.left=!1}if(this.controls.right){if("place"==this.mode)this.placeLoc[0]=(this.placeLoc[0]+1)%(9-e);else{this.selectedIndex=(this.selectedIndex+1)%3;for(var s=0;!this.pieceSelector.filledInds[this.selectedIndex]&&s<3;)this.selectedIndex=(this.selectedIndex+1)%3,s++}this.controls.right=!1}this.controls.enter&&("select"==this.mode?this.mode="place":this.#c($,this.placeLoc[0],this.placeLoc[1],e,t)||this.#d($,this.placeLoc[0],this.placeLoc[1],e,t),this.controls.enter=!1),this.controls.esc&&(this.mode="select",this.controls.esc=!1,this.placeLoc=[0,0])}#e(){try{var l=Array(8).fill(0),i=Array(8).fill(0),c=this.boardValues;for(let a=0;a<8;a++)c[a][0]&&c[a][1]&&c[a][2]&&c[a][3]&&c[a][4]&&c[a][5]&&c[a][6]&&c[a][7]&&(l[a]=1),c[0][a]&&c[1][a]&&c[2][a]&&c[3][a]&&c[4][a]&&c[5][a]&&c[6][a]&&c[7][a]&&(i[a]=1);for(let r=0;r<8;r++)if(l[r]&&(this.score+=100,this.boardValues[r]=Array(8).fill(0)),i[r]){this.score+=100;for(let h=0;h<8;h++)this.boardValues[h][r]=0}}catch(o){document.title=o}}#c(d,n,f,b,_){for(let p=0;p<_;p++)for(let k=0;k<b;k++)if(this.boardValues[p+f][k+n]&&d[p][k])return!0;return!1}#d(S,g,u,w,x){for(let y=0;y<x;y++)for(let I=0;I<w;I++)S[y][I]&&(this.score+=1,this.boardValues[y+u][I+g]=S[y][I]);this.pieceSelector.pieces[this.selectedIndex]=[[0,0,0],[0,0,0],[0,0,0],0,0],this.pieceSelector.filledInds[this.selectedIndex]=0,this.#f()||(this.pieceSelector.pieces=this.pieceSelector.generatePieces(),this.pieceSelector.filledInds=[1,1,1]);for(var L=0;!this.pieceSelector.filledInds[this.selectedIndex];)this.selectedIndex=(this.selectedIndex+1)%3,L++;this.#e(),this.mode="select",this.placeLoc=[0,0]}resetBoard(){this.boardValues=Array.from({length:8},()=>Array(8).fill(0)),this.pieceSelector.pieces=this.pieceSelector.generatePieces()}#f(){var v=this.pieceSelector.filledInds;for(let m=0;m<3;m++)if(v[m])return!0;return!1}draw($,e=this.x,t=this.y,s=this.width){$.fillStyle="blue";var l=17*this.width/12,i=s/8;$.fillRect(e,t,s,l),$.fillStyle="lightBlue";for(let c=0;c<this.boardValues.length;c++)for(let a=0;a<this.boardValues[c].length;a++)if(this.boardValues[c][a]){switch(this.boardValues[c][a]){case 1:$.fillStyle="lightBlue";break;case 2:$.fillStyle="lightGreen";break;case 3:$.fillStyle="red";break;case 4:$.fillStyle="purple";break;case 5:$.fillStyle="yellow";break;case 6:$.fillStyle="orange"}$.fillRect(e+a*i,t+c*i,i,i)}var r=this.pieceSelector.pieces[this.selectedIndex],h=r[5],o=r[6],d=this.#c(r,this.placeLoc[0],this.placeLoc[1],h,o);this.pieceSelector.draw($,this.selectedIndex,this.mode,this.placeLoc,d,e,t+s,s),$.fillStyle="lightBlue",$.font="40px Anta",$.fillText(this.score.toString(),this.x+this.width/2,17*this.width/12)}}const blockCanvas=document.getElementById("blockCanvas");blockCanvas.width=800,blockCanvas.height=window.innerHeight;const blockCtx=blockCanvas.getContext("2d"),boardWidth=425;var board=new Board((blockCanvas.width-425)/2,(blockCanvas.height-602.0833333333334)/2,425,"KEYS");function animate(){blockCtx.clearRect(0,0,blockCanvas.width,blockCanvas.height),board.update(),board.draw(blockCtx),requestAnimationFrame(animate)}animate();